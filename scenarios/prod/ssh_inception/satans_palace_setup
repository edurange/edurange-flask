#!/usr/bin/env bash

getout=$(cat << "EOF"
  ▄████ ▓█████▄▄▄█████▓    ▒█████   █    ██ ▄▄▄█████▓ ▐██▌  ▐██▌  ▐██▌  ▐██▌  ▐██▌ 
 ██▒ ▀█▒▓█   ▀▓  ██▒ ▓▒   ▒██▒  ██▒ ██  ▓██▒▓  ██▒ ▓▒ ▐██▌  ▐██▌  ▐██▌  ▐██▌  ▐██▌ 
▒██░▄▄▄░▒███  ▒ ▓██░ ▒░   ▒██░  ██▒▓██  ▒██░▒ ▓██░ ▒░ ▐██▌  ▐██▌  ▐██▌  ▐██▌  ▐██▌ 
░▓█  ██▓▒▓█  ▄░ ▓██▓ ░    ▒██   ██░▓▓█  ░██░░ ▓██▓ ░  ▓██▒  ▓██▒  ▓██▒  ▓██▒  ▓██▒ 
░▒▓███▀▒░▒████▒ ▒██▒ ░    ░ ████▓▒░▒▒█████▓   ▒██▒ ░  ▒▄▄   ▒▄▄   ▒▄▄   ▒▄▄   ▒▄▄  
 ░▒   ▒ ░░ ▒░ ░ ▒ ░░      ░ ▒░▒░▒░ ░▒▓▒ ▒ ▒   ▒ ░░    ░▀▀▒  ░▀▀▒  ░▀▀▒  ░▀▀▒  ░▀▀▒ 
  ░   ░  ░ ░  ░   ░         ░ ▒ ▒░ ░░▒░ ░ ░     ░     ░  ░  ░  ░  ░  ░  ░  ░  ░  ░ 
░ ░   ░    ░    ░         ░ ░ ░ ▒   ░░░ ░ ░   ░          ░     ░     ░     ░     ░ 
      ░    ░  ░               ░ ░     ░               ░     ░     ░     ░     ░    
EOF
)

message=$(cat << "EOF"
  ██████  ▄▄▄     ▄▄▄█████▓ ▄▄▄       ███▄    █   ██████     ██▓███   ▄▄▄       ██▓    ▄▄▄       ▄████▄  ▓█████ 
▒██    ▒ ▒████▄   ▓  ██▒ ▓▒▒████▄     ██ ▀█   █ ▒██    ▒    ▓██░  ██▒▒████▄    ▓██▒   ▒████▄    ▒██▀ ▀█  ▓█   ▀ 
░ ▓██▄   ▒██  ▀█▄ ▒ ▓██░ ▒░▒██  ▀█▄  ▓██  ▀█ ██▒░ ▓██▄      ▓██░ ██▓▒▒██  ▀█▄  ▒██░   ▒██  ▀█▄  ▒▓█    ▄ ▒███   
  ▒   ██▒░██▄▄▄▄██░ ▓██▓ ░ ░██▄▄▄▄██ ▓██▒  ▐▌██▒  ▒   ██▒   ▒██▄█▓▒ ▒░██▄▄▄▄██ ▒██░   ░██▄▄▄▄██ ▒▓▓▄ ▄██▒▒▓█  ▄ 
▒██████▒▒ ▓█   ▓██▒ ▒██▒ ░  ▓█   ▓██▒▒██░   ▓██░▒██████▒▒   ▒██▒ ░  ░ ▓█   ▓██▒░██████▒▓█   ▓██▒▒ ▓███▀ ░░▒████▒
▒ ▒▓▒ ▒ ░ ▒▒   ▓▒█░ ▒ ░░    ▒▒   ▓▒█░░ ▒░   ▒ ▒ ▒ ▒▓▒ ▒ ░   ▒▓▒░ ░  ░ ▒▒   ▓▒█░░ ▒░▓  ░▒▒   ▓▒█░░ ░▒ ▒  ░░░ ▒░ ░
░ ░▒  ░ ░  ▒   ▒▒ ░   ░      ▒   ▒▒ ░░ ░░   ░ ▒░░ ░▒  ░ ░   ░▒ ░       ▒   ▒▒ ░░ ░ ▒  ░ ▒   ▒▒ ░  ░  ▒    ░ ░  ░
░  ░  ░    ░   ▒    ░        ░   ▒      ░   ░ ░ ░  ░  ░     ░░         ░   ▒     ░ ░    ░   ▒   ░           ░   
      ░        ░  ░              ░  ░         ░       ░                    ░  ░    ░  ░     ░  ░░ ░         ░  ░
░ 
EOF
)

awk -F: '$3 >= 1000 && $1 != "nobody" {print $1}' /etc/passwd > /usr/local/src/user_names.txt

while read user; do
	cd /home/$user

	echo "$message" > message
	chmod 404 message
	echo 'cat message' >> .bashrc

	# change password
	echo -e "52efb7de\\n52efb7de" | passwd $user

	msg="CONGRATS YOU ARE THE SSH INCEPTION MASTER. Here is your proof: 5b2687d5"

	echo "${msg}" | tr '[A-Za-z]' '[X-ZA-Wx-za-w]' > final_flag

	chown $user:$user *
	chmod 400 *

  	# moved from /tmp to home because /tmp may get wiped
  	echo "$getout" > .getout
  	chmod 404 .getout
  	echo 'cat .getout' >> .bashrc

  	echo 'exit' >> .bashrc

done</usr/local/src/user_names.txt
